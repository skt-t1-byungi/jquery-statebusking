!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(a){var c=a.statebus,i=c.stores={},f=c.views={},o={};c.store=function(n,t,e){i[n]=u(i,t,e);return s(function(t,e){return c.createStore(n,t,e)},n)},c.createStore=function(t,e,n){var r=o[e]=c(e,p(i,t),n.override);return"function"==typeof r.state&&(r.state=r.state(n)),r.init&&r.init(n),r};var r={$:function(t){return this.$el.find(t)},getStore:function(t){return"string"==typeof t?o[t]:t},getState:function(t,e){return function(t,e,n){e=e.split(".");for(;e.length;)if(!(t=t[e.shift()]))return n;return t}(this.getStore(t).state,e)},dispatch:function(){var r=a.makeArray(arguments),i=r.shift(),o=[];return a.each(this.$$$subscriptions,function(t,e){var n=e.store;-1===o.indexOf(n)&&(o.push(n),n.action[i]&&n.action[i].apply(null,r))}),this},dispatchAll:function(){var t=a.makeArray(arguments),e=t.shift();for(var n in o){var r=o[n];r.action[e]&&r.action[e].apply(null,t)}return this},listenTo:function(t,e,n,r){var i=(t=this.getStore(t)).on(e,a.proxy(n,this),r);return this.$$$subscriptions.push({unsubscribe:i,store:t}),i},remove:function(){return this.$el.remove(),a.each(this.$$$subscriptions,function(t,e){e.unsubscribe()}),this}};function u(e,t,n){return n||(n=t,t=[]),t=a.map([].concat(t),function(t){return p(e,t)}),a.extend.apply(null,[!0,{}].concat(t,n))}function p(t,e){return"string"==typeof e?t[e]:e&&e.$$$defName?t[e.$$$defName]:e}function s(t,e){return a.extend(t,{$$$def:e})}c.view=function(e,t,n){f[e]=a.extend({},r,u(f,t,n));return s(function(t){return c.createView(e,t)},e)},c.createView=function(t,e){e=e||{};var r=c("__views__/"+t+"@"+$++,p(f,t),e.override),n=h(r,"el",e);n||(n=document.createElement(h(r,"tagName",e)||"div")),n.jquery&&(n=n.get(0));var i=r.$el=a(n).eq(0),o=h(r,"attrs",e);o&&i.attr(o);var u=h(r,"events",e);if(u){var s=/^(\S+)\s*(.*)$/;a.each(u,function(t,e){"string"==typeof e&&(e=r[e]);var n=t.match(s);i.on(n[1],n[2],a.proxy(e,r))})}return r.$$$subscriptions=[],"function"==typeof r.state&&(r.state=r.state(e)),r.init&&r.init(e),r};var $=0;function h(t,e,n){return"function"==typeof t[e]?t[e](n):n.hasOwnProperty(e)?n[e]:t[e]}});