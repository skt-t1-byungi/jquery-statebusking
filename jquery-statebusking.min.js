!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(c){var a=c.statebus,r=a.stores={},f=a.views={},u=[];a.store=function(n,t,e){r[n]=o(r,t,e);return s(function(t,e){return a.createStore(n,t,e)},n)},a.createStore=function(t,e,n){return n=n||{},-1===u.indexOf(e)&&u.push(e),$(a(e,p(r,t),n.override),n)};var i={$:function(t){return this.$el.find(t)},getState:function(t,e,n){return function(t,e,n){e=e.split(".");for(;e.length;)if(!(t=t[e.shift()]))return n;return t}(a.state[t],e,n)},dispatch:function(){var r=c.makeArray(arguments),i=r.shift(),u=[];return c.each(this.$$$subscriptions,function(t,e){var n=e.store;-1===u.indexOf(n)&&(u.push(n),n.action[i]&&n.action[i].apply(null,r))}),this},dispatchAll:function(){var r=c.makeArray(arguments),i=r.shift();return c.each(u,function(t,e){var n=a.action[e];n&&n[i]&&n[i].apply(null,r)}),this},listenTo:function(t,e,n,r){var i=(t=this.getStore(t)).on(e,c.proxy(n,this),r),u={unsubscribe:i,store:t};this.$$$subscriptions.push(u);var o=this;return function(){var t=o.$$$subscriptions;t.splice(t.indexOf(u),1),i()}},remove:function(){return this.$el.remove(),c.each(this.$$$subscriptions,function(t,e){e.unsubscribe()}),this.$$$subscriptions=[],this}};function $(t,e){return"function"==typeof t.state&&(t.state=t.state(e)),t.init&&t.init(e),t}function o(e,t,n){return n||(n=t,t=[]),t=c.map([].concat(t),function(t){return p(e,t)}),c.extend.apply(null,[!0,{}].concat(t,n))}function p(t,e){return"string"==typeof e?t[e]:e&&e.$$$defName?t[e.$$$defName]:e}function s(t,e){return c.extend(t,{$$$def:e})}a.view=function(e,t,n){f[e]=c.extend({},i,o(f,t,n));return s(function(t){return a.createView(e,t)},e)},a.createView=function(t,e){e=e||{};var r=a("__views__/"+t+"@"+h++,p(f,t),e.override),n=v(r,"el",e);n||(n=document.createElement(v(r,"tagName",e)||"div")),n.jquery&&(n=n.get(0));var i=r.$el=c(n).eq(0),u=v(r,"attrs",e);u&&i.attr(u);var o=v(r,"events",e);if(o){var s=/^(\S+)\s*(.*)$/;c.each(o,function(t,e){"string"==typeof e&&(e=r[e]);var n=t.match(s);i.on(n[1],n[2],c.proxy(e,r))})}return r.$$$subscriptions=[],$(r,e)};var h=0;function v(t,e,n){return"function"==typeof t[e]?t[e](n):n.hasOwnProperty(e)?n[e]:t[e]}});