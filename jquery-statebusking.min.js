!function(t,n){"object"==typeof module&&module.exports?n(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],n):n(t.jQuery||t.$)}(window||this,function(c){var $=c.statebus,r=$.stores={},p=$.views={},o=[];$.store=function(e,t,n){r[e]=u(r,t,n);return a(function(t,n){return $.createStore(e,t,n)},e)},$.createStore=function(t,n,e){return e=e||{},-1===o.indexOf(n)&&o.push(n),h($(n,v(r,t),!0),e)};var i={$:function(t){return this.$el.find(t)},getState:function(t,n,e){return y(s(t,"state"),n,e)},getPrevState:function(t,n,e){return y(s(t,"prevState"),n,e)},dispatch:function(){var r=c.makeArray(arguments),i=r.shift(),o=[];return c.each(this.$$$subs,function(t,n){var e=n.action;-1===o.indexOf(e)&&(o.push(e),e[i]&&e[i].apply(null,r))}),this},dispatchAll:function(){var r=c.makeArray(arguments),i=r.shift();return c.each(o,function(t,n){var e=$.action[n];e&&e[i]&&e[i].apply(null,r)}),this},listenTo:function(t,n,e,r){var i,o;"string"==typeof t?(n=t+"."+n,i=$.action[t],o=$.on):(i=t.action,o=t.on);var u=o(n,c.proxy(e,this),r),a={off:u,action:i};this.$$$subs.push(a);var s=this;return function(){var t=s.$$$subs;t.splice(t.indexOf(a),1),u()}},remove:function(){return this.$el.remove(),$.remove(this.$$$ns),c.each(this.$$$subs,function(t,n){n.off()}),this.$$$subs=[],this}};function h(t,n){return t.init&&t.init(n),t}function u(n,t,e){return e||(e=t,t=[]),t=c.map([].concat(t),function(t){return v(n,t)}),c.extend.apply(null,[!0,{}].concat(t,e))}function v(t,n){var e="string"==typeof n?t[n]:n&&n.$$$name?t[n.$$$name]:n;if(e)return e;throw new TypeError('[statebusking] Unknown definition. ("'+n+'")')}function a(t,n){return c.extend(t,{$$$name:n})}$.view=function(n,t,e){p[n]=c.extend({},i,u(p,t,e));return a(function(t){return $.createView(n,t)},n)},$.createView=function(t,n){if(n=n||{},!c.isPlainObject(n))throw new TypeError('[statebusking] Expected "options" to be plain object. ("'+typeof n+'")');var e=function r(t){return"__views__/"+t+"@"+l++}(t),i=$(e,v(p,t),!0),o=d(i,"el",n);o||(o=document.createElement(d(i,"tagName",n)||"div")),o.jquery&&(o=o.get(0));var u=i.$el=c(o).eq(0),a=d(i,"attrs",n);a&&u.attr(a);var s=d(i,"events",n);if(s){var f=/^(\S+)\s*(.*)$/;c.each(s,function(t,n){"string"==typeof n&&(n=y(i,n,c.noop));var e=t.match(f);u.on(e[1],e[2],c.proxy(n,i))})}return i.$$$subs=[],i.$$$ns=e,h(i,n)};var l=0;function d(t,n,e){return e.hasOwnProperty(n)?e[n]:"function"==typeof t[n]?t[n](e):t[n]}function s(t,n){return"string"==typeof t?$[n][t]:t[n]}function y(t,n,e){for(n=n.split(".");n.length;)if((t=t[n.shift()])===undefined)return e;return t}});