!function(t,n){"object"==typeof module&&module.exports?n(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],n):n(t.jQuery||t.$)}(window||this,function(s){var c=s.statebus,r=c.stores={},$=c.views={},u=[];c.store=function(e,t,n){r[e]=o(r,t,n);return a(function(t,n){return c.createStore(e,t,n)},e)},c.createStore=function(t,n,e){return e=e||{},-1===u.indexOf(n)&&u.push(n),h(c(n,p(r,t),!0),e)};var i={$:function(t){return this.$el.find(t)},getState:function(t,n,e){return d(f(t,"state"),n,e)},getPrevState:function(t,n,e){return d(f(t,"prevState"),n,e)},dispatch:function(){var r=s.makeArray(arguments),i=r.shift(),u=[];return s.each(this.$$$subs,function(t,n){var e=n.action;-1===u.indexOf(e)&&(u.push(e),e[i]&&e[i].apply(null,r))}),this},dispatchAll:function(){var r=s.makeArray(arguments),i=r.shift();return s.each(u,function(t,n){var e=c.action[n];e&&e[i]&&e[i].apply(null,r)}),this},listenTo:function(t,n,e,r){var i,u;"string"==typeof t?(n=t+"."+n,i=c.action[t],u=c.on):(i=t.action,u=t.on);var o=u(n,s.proxy(e,this),r),a={off:o,action:i};this.$$$subs.push(a);var f=this;return function(){var t=f.$$$subs;t.splice(t.indexOf(a),1),o()}},remove:function(){return this.$el.remove(),c.remove(this.$$$ns),s.each(this.$$$subs,function(t,n){n.off()}),this.$$$subs=[],this}};function h(t,n){return t.init&&t.init(n),t}function o(n,t,e){return e||(e=t,t=[]),t=s.map([].concat(t),function(t){return p(n,t)}),s.extend.apply(null,[!0,{}].concat(t,e))}function p(t,n){var e="string"==typeof n?t[n]:n&&n.$$$name?t[n.$$$name]:n;if(e)return e;throw new TypeError('[statebusking] Unknown definition. ("'+n+'")')}function a(t,n){return s.extend(t,{$$$name:n})}c.view=function(n,t,e){$[n]=s.extend({},i,o($,t,e));return a(function(t){return c.createView(n,t)},n)},c.createView=function(t,n){n=n||{};var e="__views__/"+t+"@"+v++,r=c(e,p($,t),!0),i=l(r,"el",n);i||(i=document.createElement(l(r,"tagName",n)||"div")),i.jquery&&(i=i.get(0));var u=r.$el=s(i).eq(0),o=l(r,"attrs",n);o&&u.attr(o);var a=l(r,"events",n);if(a){var f=/^(\S+)\s*(.*)$/;s.each(a,function(t,n){"string"==typeof n&&(n=r[n]);var e=t.match(f);u.on(e[1],e[2],s.proxy(n,r))})}return r.$$$subs=[],r.$$$ns=e,h(r,n)};var v=0;function l(t,n,e){return"function"==typeof t[n]?t[n](e):e.hasOwnProperty(n)?e[n]:t[n]}function f(t,n){return"string"==typeof t?c[n][t]:t[n]}function d(t,n,e){for(n=n.split(".");n.length;)if((t=t[n.shift()])===undefined)return e;return t}});