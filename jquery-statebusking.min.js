!function(t,n){"object"==typeof module&&module.exports?n(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],n):n(t.jQuery||t.$)}(window||this,function(f){var c=f.statebus,r=c.stores={},$=c.views={},u=[];c.store=function(e,t,n){r[e]=o(r,t,n);return s(function(t,n){return c.createStore(e,t,n)},e)},c.createStore=function(t,n,e){return e=e||{},-1===u.indexOf(n)&&u.push(n),h(c(n,p(r,t),!0),e)};var i={$:function(t){return this.$el.find(t)},getState:function(t,n,e){return function(t,n,e){n=n.split(".");for(;n.length;)if((t=t[n.shift()])===undefined)return e;return t}(c.state[t],n,e)},dispatch:function(){var r=f.makeArray(arguments),i=r.shift(),u=[];return f.each(this.$$$subs,function(t,n){var e=n.store;-1===u.indexOf(e)&&(u.push(e),e.action[i]&&e.action[i].apply(null,r))}),this},dispatchAll:function(){var r=f.makeArray(arguments),i=r.shift();return f.each(u,function(t,n){var e=c.action[n];e&&e[i]&&e[i].apply(null,r)}),this},listenTo:function(t,n,e,r){var i=(t=this.getStore(t)).on(n,f.proxy(e,this),r),u={off:i,store:t};this.$$$subs.push(u);var o=this;return function(){var t=o.$$$subs;t.splice(t.indexOf(u),1),i()}},remove:function(){return this.$el.remove(),c.remove(this.$$ns),f.each(this.$$$subs,function(t,n){n.off()}),this.$$$subs=[],this}};function h(t,n){return"function"==typeof t.state&&(t.state=t.state(n)),t.init&&t.init(n),t}function o(n,t,e){return e||(e=t,t=[]),t=f.map([].concat(t),function(t){return p(n,t)}),f.extend.apply(null,[!0,{}].concat(t,e))}function p(t,n){var e="string"==typeof n?t[n]:n&&n.$$$name?t[n.$$$name]:n;if(e)return e;throw new TypeError('[statebusking] Unknown definition. ("'+n+'")')}function s(t,n){return f.extend(t,{$$$name:n})}c.view=function(n,t,e){$[n]=f.extend({},i,o($,t,e));return s(function(t){return c.createView(n,t)},n)},c.createView=function(t,n){n=n||{};var e="__views__/"+t+"@"+v++,r=c(e,p($,t),!0),i=l(r,"el",n);i||(i=document.createElement(l(r,"tagName",n)||"div")),i.jquery&&(i=i.get(0));var u=r.$el=f(i).eq(0),o=l(r,"attrs",n);o&&u.attr(o);var s=l(r,"events",n);if(s){var a=/^(\S+)\s*(.*)$/;f.each(s,function(t,n){"string"==typeof n&&(n=r[n]);var e=t.match(a);u.on(e[1],e[2],f.proxy(n,r))})}return r.$$$subs=[],r.$$$ns=e,h(r,n)};var v=0;function l(t,n,e){return"function"==typeof t[n]?t[n](e):e.hasOwnProperty(n)?e[n]:t[n]}});