!function(t,n){"object"==typeof module&&module.exports?n(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],n):n(t.jQuery||t.$)}(window||this,function(a){var f=a.statebus,r=f.stores={},c=f.views={},u=[];f.store=function(e,t,n){r[e]=o(r,t,n);return s(function(t,n){return f.createStore(e,t,n)},e)},f.createStore=function(t,n,e){return e=e||{},-1===u.indexOf(n)&&u.push(n),$(f(n,h(r,t),!0),e)};var i={$:function(t){return this.$el.find(t)},getState:function(t,n,e){return function(t,n,e){n=n.split(".");for(;n.length;)if((t=t[n.shift()])===undefined)return e;return t}(f.state[t],n,e)},dispatch:function(){var r=a.makeArray(arguments),i=r.shift(),u=[];return a.each(this.$$$subs,function(t,n){var e=n.store;-1===u.indexOf(e)&&(u.push(e),e.action[i]&&e.action[i].apply(null,r))}),this},dispatchAll:function(){var r=a.makeArray(arguments),i=r.shift();return a.each(u,function(t,n){var e=f.action[n];e&&e[i]&&e[i].apply(null,r)}),this},listenTo:function(t,n,e,r){var i=(t=this.getStore(t)).on(n,a.proxy(e,this),r),u={off:i,store:t};this.$$$subs.push(u);var o=this;return function(){var t=o.$$$subs;t.splice(t.indexOf(u),1),i()}},remove:function(){return this.$el.remove(),a.each(this.$$$subs,function(t,n){n.off()}),this.$$$subs=[],this}};function $(t,n){return"function"==typeof t.state&&(t.state=t.state(n)),t.init&&t.init(n),t}function o(n,t,e){return e||(e=t,t=[]),t=a.map([].concat(t),function(t){return h(n,t)}),a.extend.apply(null,[!0,{}].concat(t,e))}function h(t,n){var e="string"==typeof n?t[n]:n&&n.$$$name?t[n.$$$name]:n;if(e)return e;throw new TypeError('[statebusking] Unknown definition"('+n.toString()+')."')}function s(t,n){return a.extend(t,{$$$name:n})}f.view=function(n,t,e){c[n]=a.extend({},i,o(c,t,e));return s(function(t){return f.createView(n,t)},n)},f.createView=function(t,n){n=n||{};var r=f("__views__/"+t+"@"+p++,h(c,t),!0),e=v(r,"el",n);e||(e=document.createElement(v(r,"tagName",n)||"div")),e.jquery&&(e=e.get(0));var i=r.$el=a(e).eq(0),u=v(r,"attrs",n);u&&i.attr(u);var o=v(r,"events",n);if(o){var s=/^(\S+)\s*(.*)$/;a.each(o,function(t,n){"string"==typeof n&&(n=r[n]);var e=t.match(s);i.on(e[1],e[2],a.proxy(n,r))})}return r.$$$subs=[],$(r,n)};var p=0;function v(t,n,e){return"function"==typeof t[n]?t[n](e):e.hasOwnProperty(n)?e[n]:t[n]}});